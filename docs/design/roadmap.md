# 開發路線圖 - Body Hack

> 最後更新：2025-02-03
> 狀態：規劃中

---

## 版本規劃

### v0.1 - PoC 核心功能

**目標**：驗證核心流程，建立最小可用版本

| 模組 | 功能 | 優先級 |
|------|------|--------|
| 時間軸 | 顯示今日記錄 | P0 |
| 飲食記錄 | 三段式輸入 + AI 整理 | P0 |
| 生理數據 | OCR 輸入（CGM、血壓、體脂） | P0 |
| AI 洞察 | 單筆記錄回饋 | P1 |
| Google Sheets | 資料讀寫 | P0 |

### v0.2 - 完整輸入

**目標**：補齊所有輸入類型

| 模組 | 功能 | 優先級 |
|------|------|--------|
| 運動記錄 | 基本輸入 | P1 |
| 飲水記錄 | 快速輸入 | P1 |
| 簡易事件 | 類別 + 描述 | P1 |
| 時間軸 | 日期切換 | P1 |

### v0.3 - AI 強化

**目標**：強化 AI 互動體驗

| 模組 | 功能 | 優先級 |
|------|------|--------|
| AI 洞察 | 今日脈絡回饋 | P1 |
| AI 洞察 | 週回顧分析 | P2 |
| 營養推估 | AI 推估功能 | P2 |

### v0.4 - 目標與匯出

**目標**：建立完整的追蹤閉環

| 模組 | 功能 | 優先級 |
|------|------|--------|
| 目標管理 | CRUD | P2 |
| 匯出 | CSV + Prompt | P2 |

---

## 未來改版方向

### 🔬 營養成分估算模組優化

> 此功能在 PoC 階段使用 AI 推估，未來可逐步升級

#### Phase 1：AI 推估（PoC）

```
營養資訊輸入
├─ 有標示 → 手動輸入 or OCR 辨識營養標籤
└─ 沒標示 → [🤖 AI 推估] → 標記 [推估]
```

**實作重點**：
- AI 推估時標註 `[推估]`，與實際標示區分
- 推估結果存在 `note` 欄位

#### Phase 2：自建常用食材庫

```
新增 Sheet: Nutrition_Reference

| 欄位 | 說明 |
|------|------|
| food_name | 食物名稱 |
| category | 分類（主食/肉類/蔬菜...） |
| calories | 熱量 (kcal) |
| protein | 蛋白質 (g) |
| carbs | 碳水化合物 (g) |
| fat | 脂肪 (g) |
| serving_size | 份量說明 |
| source | 資料來源（標示/食藥署/推估） |
```

**功能**：
- 每次 OCR 營養標籤後，可選「加入資料庫」
- 下次吃同樣的食物，直接從資料庫帶入
- 累積個人常用食材庫

**查詢流程**：

```
食材名稱 → 查 Nutrition_Reference
         ├─ 有 → 直接用
         └─ 沒有 → AI 推估
```

#### Phase 3：串接食藥署資料庫

**資料來源**：
- 政府資料開放平臺：https://data.gov.tw/dataset/8543
- 食藥署 Open Data API：https://data.fda.gov.tw
- 資料格式：JSON / CSV / XML
- 資料筆數：約 2,180 筆原型食材

**資料欄位**：
- 食品分類、樣品名稱、俗名、英文名稱
- 每 100g 含量：熱量、蛋白質、碳水、脂肪...
- 共 40+ 種營養素

**整合方式選項**：
1. **即時 API 查詢**：資料最新，但需網路、有延遲
2. **下載 JSON 當本地資料庫**：離線可用，需定期更新
3. **匯入 Google Sheet**：整合現有架構

**查詢流程升級**：

```
食材名稱 → 查自建資料庫
         ├─ 有 → 直接用
         └─ 沒有 → 查食藥署資料庫
                  ├─ 有 → AI 換算份量後回傳
                  └─ 沒有 → AI 推估
```

**注意事項**：
- 食藥署資料都是原型食材（雞腿、白飯），沒有便當、餐廳料理
- 便利商店食品需要自己累積

#### Phase 4：智慧拆解 + 加總

**複合料理處理**：

```
「雞腿便當」
    ↓
AI 拆解為食材清單：
├─ 雞腿 × 1（約 150g）
├─ 白飯 × 0.25 碗（約 40g）
├─ 炒青菜（約 80g）
└─ 滷蛋 × 1（約 50g）
    ↓
各食材查資料庫 → 換算份量 → 加總
    ↓
回傳：約 480kcal、蛋白質 28g、碳水 35g、脂肪 22g
```

#### 模組化架構

```
src/features/nutrition/          # 獨立營養模組
├─ __init__.py
├─ ocr.py                       # 營養標籤 OCR
├─ estimator.py                 # AI 推估（PoC 先做這個）
├─ reference_db.py              # 自建資料庫查詢（Phase 2）
├─ fda_api.py                   # 食藥署 API 串接（Phase 3）
└─ calculator.py                # 智慧拆解 + 加總（Phase 4）
```

---

### 📱 其他未來方向

#### 原生 App

- PoC 驗證流程後，考慮開發原生 Android App
- 優點：更好的 UX、離線支援、推播通知

#### API 串接

- 亞培 LibreLink API（如果開放）
- Garmin Connect API
- 減少手動 OCR 步驟

#### 資料分析

- 血糖與飲食的交叉分析
- 長期趨勢視覺化
- 個人化洞察

---

## 技術債清單

| 項目 | 說明 | 優先級 |
|------|------|--------|
| 營養資訊結構化 | 目前存在 note，之後可能需要獨立欄位 | 低 |
| 資料驗證 | 前端驗證較弱，可加強 | 中 |
| 錯誤處理 | API 錯誤的 UX 可優化 | 中 |
