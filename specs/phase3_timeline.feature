@MVP
Feature: 時間軸與儀表板
  作為使用者
  我想要在主畫面看到今日記錄
  以便確認輸入成功並掌握今日狀態

  Background:
    Given 使用者已開啟 App

  # ═══════════════════════════════════════
  # 時間軸顯示
  # ═══════════════════════════════════════

  @happy-path
  Scenario: 主畫面顯示今日記錄
    Given 今日有以下記錄：
      | 時間  | 類型 | 內容           |
      | 12:30 | meal | 雞胸肉便當     |
      | 08:00 | water| 500ml 水       |
    When 使用者查看主畫面
    Then 時間軸顯示 2 筆記錄
    And 記錄按時間排序（最新在上）
    And 12:30 的飲食記錄顯示在 08:00 的飲水記錄上方

  @happy-path
  Scenario: 時間軸氣泡顯示記錄摘要
    Given 今日有飲食記錄「午餐：雞胸肉便當」於 12:30
    When 使用者查看主畫面
    Then 時間軸顯示一個氣泡
    And 氣泡顯示時間「12:30」
    And 氣泡顯示類型圖示（🍽）
    And 氣泡顯示內容摘要「雞胸肉便當」

  @edge-case
  Scenario: 今日無記錄時顯示空狀態
    Given 今日沒有任何記錄
    When 使用者查看主畫面
    Then 時間軸顯示空狀態提示
    And 提示文字為「今天還沒有記錄，點擊「＋輸入」開始」

  @happy-path
  Scenario: 往下滾動載入更多記錄
    Given 今日有 10 筆記錄
    When 使用者往下滾動時間軸
    Then 可以看到所有 10 筆記錄

  # ═══════════════════════════════════════
  # 儀表板
  # ═══════════════════════════════════════

  @happy-path
  Scenario: 儀表板顯示今日飲水量
    Given 今日有以下飲水記錄：
      | 時間  | 水量   |
      | 08:00 | 500ml  |
      | 12:00 | 300ml  |
      | 15:00 | 200ml  |
    When 使用者查看主畫面
    Then 儀表板顯示「💧 1000ml」

  @happy-path
  Scenario: 儀表板顯示今日餐數
    Given 今日有以下飲食記錄：
      | 時間  | 餐別 |
      | 08:00 | 早餐 |
      | 12:30 | 午餐 |
    When 使用者查看主畫面
    Then 儀表板顯示「🍽 2 餐」

  @happy-path
  Scenario: 儀表板顯示今日吸菸次數
    Given 今日有 3 筆吸菸記錄
    When 使用者查看主畫面
    Then 儀表板顯示「🚬 3 根」

  @edge-case
  Scenario: 無記錄時儀表板顯示零值
    Given 今日沒有任何記錄
    When 使用者查看主畫面
    Then 儀表板顯示「💧 0ml」
    And 儀表板顯示「🍽 0 餐」
    And 儀表板顯示「🚬 0 根」

  # ═══════════════════════════════════════
  # 日期切換
  # ═══════════════════════════════════════

  @happy-path
  Scenario: 點擊日期開啟日曆選擇器
    Given 使用者在主畫面
    When 使用者點擊頂部日期
    Then 顯示日曆選擇器

  @happy-path
  Scenario: 選擇日期後顯示該日記錄
    Given 使用者在主畫面
    And 2/3 有飲食記錄「早餐：蛋餅」
    And 2/4（今日）有飲食記錄「午餐：便當」
    When 使用者點擊日期並選擇 2/3
    Then 頂部日期顯示「2/3」
    And 時間軸顯示 2/3 的記錄
    And 時間軸不顯示 2/4 的記錄
    And 儀表板顯示 2/3 的統計

  @happy-path
  Scenario: 切換日期後可返回今日
    Given 使用者正在查看 2/3 的記錄
    When 使用者點擊日期並選擇今日（2/4）
    Then 頂部日期顯示「2/4」
    And 時間軸顯示今日記錄

  @edge-case
  Scenario: 選擇無記錄的日期
    Given 2/1 沒有任何記錄
    When 使用者切換到 2/1
    Then 時間軸顯示空狀態提示
    And 儀表板顯示零值

  # ═══════════════════════════════════════
  # 錯誤處理
  # ═══════════════════════════════════════

  @error-handling
  Scenario: 載入記錄失敗時顯示錯誤
    Given Google Sheets 連線失敗
    When 使用者查看主畫面
    Then 顯示錯誤訊息「無法載入記錄，請檢查網路連線」
    And 顯示「重試」按鈕

  @error-handling
  Scenario: 點擊重試後重新載入
    Given 主畫面顯示載入錯誤
    And Google Sheets 連線已恢復
    When 使用者點擊「重試」
    Then 時間軸顯示記錄
